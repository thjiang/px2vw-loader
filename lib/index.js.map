{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["const loaderUtils = require(\"loader-utils\");\r\n\r\ninterface IOptions {\r\n    unitToConvert: string;\r\n    viewportWidth: number;\r\n    viewportUnit: string;\r\n    minPixelValue: number;\r\n    unitPrecision: number;\r\n}\r\n\r\nconst getOptions = loaderUtils.getOptions;\r\n\r\nconst defaultOptions: IOptions = {\r\n    unitToConvert: \"px\", // (String) 需要转换的单位，默认为\"px\"\r\n    viewportWidth: 750, // (Number) 设计稿的视口宽度\r\n    viewportUnit: \"vw\", // (String) 希望使用的视口单位\r\n    minPixelValue: 1, // (Number) 设置最小的转换数值，如果为 1 的话，只有大于 1 的值会被转换\r\n    unitPrecision: 2, // (Number) 单位转换后保留的精度\r\n};\r\n\r\nconst getUnitRegexp = (unit: string) => {\r\n    return new RegExp(\r\n        \"\\\"[^\\\"]+\\\"|'[^']+'|url\\\\([^\\\\)]+\\\\)|(\\\\d*\\\\.?\\\\d+)\" + unit,\r\n        \"g\"\r\n    );\r\n};\r\n\r\nconst toFixed = (number: number, precision: number) => {\r\n    var multiplier = Math.pow(10, precision + 1),\r\n        wholeNumber = Math.floor(number * multiplier);\r\n    return (Math.round(wholeNumber / 10) * 10) / multiplier;\r\n};\r\n\r\nconst createPxReplace = (opts: IOptions) => {\r\n    return function (m: any, $1: any) {\r\n        if (!$1) return m;\r\n        var pixels = parseFloat($1);\r\n        if (pixels <= opts.minPixelValue) return m;\r\n        var parsedVal = toFixed(\r\n            (pixels / opts.viewportWidth) * 100,\r\n            opts.unitPrecision\r\n        );\r\n        return parsedVal === 0 ? \"0\" : parsedVal + opts.viewportUnit;\r\n    };\r\n};\r\n\r\nconst px2vw = (source: string, opts: IOptions) => {\r\n    return source.replace(\r\n        getUnitRegexp(opts.unitToConvert),\r\n        createPxReplace(opts)\r\n    );\r\n};\r\n\r\nconst px2vwLoader = function (this: any, source: string) {\r\n    this.cacheable();\r\n\r\n    const options = getOptions(this) || {};\r\n    const callback = this.async();\r\n    const opts = Object.assign({}, defaultOptions, options);\r\n\r\n    callback(null, px2vw(source, opts));\r\n};\r\n\r\nexport default px2vwLoader;\r\n"],"names":["loaderUtils","require","getOptions","defaultOptions","unitToConvert","viewportWidth","viewportUnit","minPixelValue","unitPrecision","getUnitRegexp","unit","RegExp","toFixed","number","precision","multiplier","Math","pow","wholeNumber","floor","round","createPxReplace","opts","m","$1","pixels","parseFloat","parsedVal","px2vw","source","replace","px2vwLoader","cacheable","options","callback","async","Object","assign"],"mappings":";;AAAA,MAAMA,WAAW,GAAGC,OAAO,CAAC,cAAD,CAA3B,CAAA;;AAUA,MAAMC,UAAU,GAAGF,WAAW,CAACE,UAA/B,CAAA;AAEA,MAAMC,cAAc,GAAa;AAC7BC,EAAAA,aAAa,EAAE,IADc;AAE7BC,EAAAA,aAAa,EAAE,GAFc;AAG7BC,EAAAA,YAAY,EAAE,IAHe;AAI7BC,EAAAA,aAAa,EAAE,CAJc;EAK7BC,aAAa,EAAE,CALc;;AAAA,CAAjC,CAAA;;AAQA,MAAMC,aAAa,GAAIC,IAAD,IAAiB;AACnC,EAAA,OAAO,IAAIC,MAAJ,CACH,uDAAuDD,IADpD,EAEH,GAFG,CAAP,CAAA;AAIH,CALD,CAAA;;AAOA,MAAME,OAAO,GAAG,CAACC,MAAD,EAAiBC,SAAjB,KAAsC;EAClD,IAAIC,UAAU,GAAGC,IAAI,CAACC,GAAL,CAAS,EAAT,EAAaH,SAAS,GAAG,CAAzB,CAAjB;MACII,WAAW,GAAGF,IAAI,CAACG,KAAL,CAAWN,MAAM,GAAGE,UAApB,CADlB,CAAA;EAEA,OAAQC,IAAI,CAACI,KAAL,CAAWF,WAAW,GAAG,EAAzB,CAAA,GAA+B,EAAhC,GAAsCH,UAA7C,CAAA;AACH,CAJD,CAAA;;AAMA,MAAMM,eAAe,GAAIC,IAAD,IAAmB;AACvC,EAAA,OAAO,UAAUC,CAAV,EAAkBC,EAAlB,EAAyB;AAC5B,IAAA,IAAI,CAACA,EAAL,EAAS,OAAOD,CAAP,CAAA;AACT,IAAA,IAAIE,MAAM,GAAGC,UAAU,CAACF,EAAD,CAAvB,CAAA;AACA,IAAA,IAAIC,MAAM,IAAIH,IAAI,CAACf,aAAnB,EAAkC,OAAOgB,CAAP,CAAA;AAClC,IAAA,IAAII,SAAS,GAAGf,OAAO,CAClBa,MAAM,GAAGH,IAAI,CAACjB,aAAf,GAAgC,GADb,EAEnBiB,IAAI,CAACd,aAFc,CAAvB,CAAA;IAIA,OAAOmB,SAAS,KAAK,CAAd,GAAkB,GAAlB,GAAwBA,SAAS,GAAGL,IAAI,CAAChB,YAAhD,CAAA;GARJ,CAAA;AAUH,CAXD,CAAA;;AAaA,MAAMsB,KAAK,GAAG,CAACC,MAAD,EAAiBP,IAAjB,KAAmC;AAC7C,EAAA,OAAOO,MAAM,CAACC,OAAP,CACHrB,aAAa,CAACa,IAAI,CAAClB,aAAN,CADV,EAEHiB,eAAe,CAACC,IAAD,CAFZ,CAAP,CAAA;AAIH,CALD,CAAA;;AAOA,MAAMS,WAAW,GAAG,UAAqBF,MAArB,EAAmC;AACnD,EAAA,IAAA,CAAKG,SAAL,EAAA,CAAA;AAEA,EAAA,MAAMC,OAAO,GAAG/B,UAAU,CAAC,IAAD,CAAV,IAAoB,EAApC,CAAA;AACA,EAAA,MAAMgC,QAAQ,GAAG,IAAKC,CAAAA,KAAL,EAAjB,CAAA;EACA,MAAMb,IAAI,GAAGc,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBlC,cAAlB,EAAkC8B,OAAlC,CAAb,CAAA;EAEAC,QAAQ,CAAC,IAAD,EAAON,KAAK,CAACC,MAAD,EAASP,IAAT,CAAZ,CAAR,CAAA;AACH;;;;"}